---
platform: linux

image_resource:
  type: registry-image
  source: { repository: node, tag: "12" }

inputs:
  - name: protect-js-sdk-master

run:
  path: /bin/sh
  args:
    - -c
    - |

      echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" > ~/.npmrc

      cd protect-js-sdk-master

      if ! yarn version --patch
      then
        echo "ERROR: yarn version patch update failed"
        exit 1
      fi

      PACKAGE_VERSION=$(cat package.json | grep version | head -1 | awk -F: '{ print $2 }' | sed 's/[\",]//g' | tr -d '[[:space:]]')
      if ! yarn publish --new-version $PACKAGE_VERSION
      then
        echo "ERROR: yarn publish failed"
        exit 1
      fi

